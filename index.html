<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Clinical Nomogram</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
body {
  font-family: Arial, sans-serif;
  margin: 30px;
}
h1 {
  margin-bottom: 5px;
}
input {
  width: 140px;
  padding: 5px;
  margin-right: 10px;
}
button {
  padding: 7px 14px;
  margin-right: 10px;
}
table {
  border-collapse: collapse;
  margin-top: 20px;
}
td, th {
  border: 1px solid #ccc;
  padding: 6px 10px;
  text-align: center;
}
canvas {
  margin-top: 30px;
  max-width: 900px;
}
.note {
  margin-top: 20px;
  font-size: 0.9em;
  color: #555;
}
</style>
</head>

<body>

<h1>Clinical Nomogram</h1>
<p>Enter the values to obtain predicted probabilities (%)</p>

<label>Baseline MRI:</label>
<input type="number" id="rm_diag" value="218.064" step="0.001">

<label>Pre-RT MRI:</label>
<input type="number" id="rm_pre" value="101.2" step="0.001">

<label>Reduction (%):</label>
<input type="number" id="rid" value="53.59" step="0.01">

<br><br>
<button onclick="calcola()">Calculate</button>

<div id="results"></div>

<canvas id="chart"></canvas>

<p class="note">
Predictions are based on multivariable logistic regression models.  
Values are expressed as estimated probabilities (%).
</p>

<script>
// ===============================
// LOGISTIC REGRESSION MODELS
// ===============================
const models = {
  "Persistent / Progressive Disease (T)": { b0:-2.207, b:[0.62,0.41,-0.55] },
  "Persistent / Progressive Disease (N)": { b0:-2.325, b:[0.58,0.47,-0.51] },
  "Persistence / Recurrence (T and N)":   { b0:-0.792, b:[0.51,0.44,-0.36] },
  "Local Recurrence (T)":                 { b0:-2.710, b:[0.49,0.33,-0.58] },
  "Nodal Recurrence (N)":                 { b0:-1.380, b:[0.55,0.39,-0.42] },
  "Distant Metastases":                   { b0:-1.122, b:[0.61,0.48,-0.29] },
  "Unfavorable Status":                   { b0:-2.060, b:[0.52,0.36,-0.47] }
};

// Means and standard deviations
const mean = [180.3, 92.1, 47.6];
const sd   = [65.2, 35.8, 18.9];

function logistic(z){
  return 1 / (1 + Math.exp(-z));
}

function calcola(){
  const x = [
    (rm_diag.value - mean[0]) / sd[0],
    (rm_pre.value - mean[1]) / sd[1],
    (rid.value     - mean[2]) / sd[2]
  ];

  let html = "<table><tr><th>Outcome</th><th>Probability (%)</th></tr>";
  let labels = [];
  let values = [];

  for (const [name, m] of Object.entries(models)) {
    const z = m.b0 + m.b[0]*x[0] + m.b[1]*x[1] + m.b[2]*x[2];
    const p = logistic(z) * 100;

    html += `<tr><td>${name}</td><td>${p.toFixed(2)}</td></tr>`;
    labels.push(name);
    values.push(p.toFixed(2));
  }

  html += "</table>";
  results.innerHTML = html;

  if (window.myChart) window.myChart.destroy();

  window.myChart = new Chart(chart, {
    type: "bar",
    data: {
      labels: labels,
      datasets: [{
        label: "Predicted Probability (%)",
        data: values
      }]
    },
    options: {
      scales: {
        y: {
          beginAtZero: true,
          max: 100
        }
      }
    }
  });
}
</script>

</body>
</html>
